<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Opto Facturatie</title>
    <link rel="stylesheet" href="/static/style.css">
    <script>
        function updateInvoiceNumber() {
            const customerId = document.getElementById('customer_id').value;
            fetch('/get-invoice-number', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ customer_id: customerId })
            })
            .then(res => res.json())
            .then(data => {
                document.getElementById('invoice_number_display').innerText = `Huidig factuurnummer: ${data.number}`;
            });
        }
    </script>
</head>
<body>
    <header>
        <button onclick="document.body.classList.toggle('dark-mode')">ðŸŒ“ Donkere modus</button>
    </header>

    <h1>Factuur Aanmaken</h1>

    <div class="nav-buttons">
        <a href="{{ url_for('add_customer') }}">Klant Toevoegen</a>
        <a href="{{ url_for('edit_customer') }}">Klant Bewerken of Verwijderen</a>
        <a href="{{ url_for('reset_counter') }}">Factuurnummer Resetten</a>
        <a href="{{ url_for('download_logs') }}">Download Logs</a>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash {{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="POST" action="{{ url_for('generate') }}">
        <label for="customer_id">Selecteer Klant:</label>
        <select name="customer_id" id="customer_id" onchange="updateInvoiceNumber()" required>
            {% for cid, info in customers.items() %}
                <option value="{{ cid }}">{{ cid }} - {{ info.name }}</option>
            {% endfor %}
        </select>

        <p id="invoice_number_display" style="margin-top:10px; font-style: italic;"></p>

        <label for="description">Omschrijving:</label>
        <input list="descriptions" name="description" id="description" placeholder="Dienst of productbeschrijving" required>
        <datalist id="descriptions">
            {% for desc in descriptions %}
                <option value="{{ desc }}">
            {% endfor %}
        </datalist>

        <label for="amount_incl">Bedrag incl. BTW (â‚¬):</label>
        <input type="number" name="amount_incl" id="amount_incl" placeholder="Bijv. 121.00" step="0.01" required>

        <label for="email">E-mail (optioneel):</label>
        <input type="text" name="email" id="email" placeholder="voorbeeld@bedrijf.nl">

        <div class="dual-buttons">
            <button type="submit">Genereer Factuur</button>
            <button type="submit" formaction="{{ url_for('preview') }}" formtarget="_blank">Voorbeeld Bekijken</button>
        </div>
    </form>
</body>
</html>
